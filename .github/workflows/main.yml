name: Get OAuth Token

on:
  push:
    branches:
      - main

jobs:
  get-token:
    runs-on: ubuntu-latest

    steps:
      - name: Request access token
        env:
          CLIENT_ID: ${{ secrets.CLIENT_ID }}
          CLIENT_SECRET: ${{ secrets.CLIENT_SECRET }}
          TOKEN_URL: ${{ secrets.TOKEN_URL }}
        run: |
          response=$(curl -s -X POST "$TOKEN_URL" \
            -u "$CLIENT_ID:$CLIENT_SECRET" \
            -H "Content-Type: application/x-www-form-urlencoded" \
            -d "grant_type=client_credentials&scope=all-apis")

          echo "Token response:"
          echo "$response"
